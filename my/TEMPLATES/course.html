<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Study Hub — Notes, DPP, PYQ, Mock Tests</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
    --bg:#f5f7fb; --card:#ffffff; --muted:#6b7280; --text:#0f1724;
    --accent-1: #3b82f6; --accent-2: #8b5cf6;
    --glass: rgba(255,255,255,0.6);
    --success:#10b981;
    --danger:#ef4444;
    --shadow: 0 10px 30px rgba(16,24,40,0.06);
    --border-color: rgba(0,0,0,0.08);
}

/* Dark theme variables (applied on body.dark) */
body.dark{
    --bg:#0b1220; --card:#0f1724; --muted:#9aa4b2; --text:#e6eef8;
    --glass: rgba(255,255,255,0.04);
    --shadow: 0 10px 30px rgba(2,6,23,0.6);
    --border-color: rgba(255,255,255,0.08);
}

/* Base */
*{box-sizing:border-box}
html,body{height:100%}
body{
    margin:0;font-family:Inter,Segoe UI,Arial,sans-serif;
    background:linear-gradient(180deg,var(--bg), #e9eefb 120px);
    color: var(--text);
    -webkit-font-smoothing:antialiased;
    transition: background .35s, color .25s;
}
body.dark { background: linear-gradient(180deg,var(--bg), #071422 120px); }

/* Utility Class */
.hidden {
    display: none !important;
}

/* Header */
header{
    display:flex;align-items:center;justify-content:space-between;
    padding:16px 20px;
    gap:16px;
    background: linear-gradient(90deg,var(--accent-1), var(--accent-2));
    color:white;
    box-shadow: 0 6px 20px rgba(59,130,246,0.12);
    position: sticky;
    top: 0;
    z-index: 1000;
}
.brand {font-weight:700; font-size:18px; letter-spacing:0.2px; cursor: pointer;}
.header-right {display:flex;gap:10px;align-items:center}

/* Theme toggle */
.theme-toggle{
    background:rgba(255,255,255,0.12);
    border:1px solid rgba(255,255,255,0.12);
    color:white;padding:8px;border-radius:10px;cursor:pointer;
    display:flex;gap:8px;align-items:center;font-weight:600;
    transition:transform .15s;
}
.theme-toggle:active{transform:scale(.98)}

/* --- AUTH & PROFILE STYLES --- */
.auth-container { display: flex; gap: 10px; align-items: center; }
.guest-actions .btn {
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(255,255,255,0.12);
    color: white;
    padding: 8px 14px;
    font-weight: 600;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s;
}
.guest-actions .btn-primary {
    background: white;
    color: var(--accent-1);
}
.guest-actions .btn:hover { background: rgba(255,255,255,0.2); }
.guest-actions .btn-primary:hover { background: #f0f0f0; }

.profile-menu-container { position: relative; }
.profile-btn {
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(255,255,255,0.12);
    color: white;
    width: 38px;
    height: 38px;
    border-radius: 50%;
    cursor: pointer;
    display: none; /* Hidden by default */
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}
.profile-btn:hover { background: rgba(255,255,255,0.2); }

.profile-dropdown {
    display: none;
    position: absolute;
    top: calc(100% + 10px);
    right: 0;
    background: var(--card);
    border-radius: 10px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border-color);
    width: 200px;
    z-index: 1001;
    padding: 8px;
    overflow: hidden;
}
.profile-dropdown.open { display: block; }

.profile-dropdown .profile-dropdown-btn {
    display: block;
    padding: 10px 15px;
    color: var(--text);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    border-radius: 6px;
    transition: all 0.2s;
    cursor: pointer;
    background: none;
    border: none;
    width: 100%;
    text-align: left;
}
.profile-dropdown .profile-dropdown-btn:hover {
    background: rgba(59,130,246,0.1);
    color: var(--accent-1);
}
.profile-dropdown .dropdown-divider {
    height: 1px;
    background: var(--border-color);
    margin: 8px 0;
}
.profile-dropdown .logout-btn { color: var(--danger); }
.profile-dropdown .logout-btn:hover {
    background: rgba(239,68,68,0.1);
    color: var(--danger);
}

[data-logged-in="true"] .guest-actions { display: none; }
[data-logged-in="true"] .profile-btn { display: flex; }
/* --- END AUTH STYLES --- */

/* Nav (horizontal) */
.nav{
    display:flex;gap:12px;align-items:center;justify-content:center;
    padding:14px;background:transparent;flex-wrap:wrap;
}
.nav button{
    background:var(--card);
    border: none;
    padding:10px 14px;
    border-radius:999px;
    cursor:pointer;
    box-shadow: var(--shadow);
    min-width:120px;
    font-weight:600;
    color: var(--text);
    transition: transform .15s, box-shadow .2s, background .2s, color .2s;
}
body.dark .nav button{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid var(--border-color);
}
.nav button:hover{ transform:translateY(-4px); box-shadow: 0 18px 40px rgba(11,20,40,0.12); }
.nav button.active{
    background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
    color:white;
    box-shadow: 0 18px 40px rgba(59,130,246,0.14);
}

/* Main layout */
.wrap{max-width:1100px;margin:20px auto;padding:0 18px}
.panel {
    margin-top:18px;
    background:var(--card);
    border-radius:14px;
    padding:18px;
    box-shadow: var(--shadow);
    transition: transform .18s, box-shadow .18s, background .25s;
}
body.dark .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid var(--border-color);
}

/* Placeholder Page Styles */
.placeholder-page h1 {
    font-size: 32px;
    color: var(--accent-1);
    margin-bottom: 20px;
}
.placeholder-page p {
    font-size: 18px;
    color: var(--muted);
    line-height: 1.6;
}

/* Collapsible style (smooth) */
.collapsible { overflow:hidden; transition: max-height .35s ease, padding .25s ease; max-height:0; padding:0 0; }
.collapsible.open { max-height:1200px; padding:12px 0 0 0; }

/* Units row */
.units{ display:flex; gap:12px; flex-wrap:wrap }
.unit-card{
    flex:1 1 260px; background: linear-gradient(180deg, var(--glass), rgba(255,255,255,0.02));
    border-radius:12px; padding:12px; cursor:pointer; border:1px solid var(--border-color);
    transition: transform .12s, box-shadow .12s, border-color .12s;
}
.unit-card:hover { transform: translateY(-6px); box-shadow: 0 20px 40px rgba(2,6,23,0.06); }
body.dark .unit-card{ border-color: var(--border-color); }

.unit-title{ display:flex;justify-content:space-between;align-items:center; font-weight:700; }
.unit-meta{ font-size:13px; color:var(--muted); margin-top:8px; }

/* inside lists */
.inside-list { margin-top:10px; padding-left:10px; }
.inside-item{
    background:transparent; border-radius:8px; padding:8px 10px; margin:8px 0; display:flex;justify-content:space-between;align-items:center;
    transition:background .15s, transform .12s;
}
.inside-item:hover{ background: rgba(59,130,246,0.06); transform: translateX(6px); }
body.dark .inside-item:hover{ background: rgba(139,92,246,0.06); }

.badge{ font-size:12px; padding:6px 8px;border-radius:999px; background:rgba(0,0,0,0.06); color:var(--muted); font-weight:600; }
body.dark .badge{ background: rgba(255,255,255,0.03); }

/* small action buttons */
.action{
    background:transparent;border:1px solid var(--border-color); padding:7px 10px;border-radius:8px;cursor:pointer;font-weight:600;
    color: var(--muted);
}
body.dark .action{ color:var(--muted) }
.action:hover { background: rgba(0,0,0,0.03); }
body.dark .action:hover { background: rgba(255,255,255,0.03); }

/* --- MODAL STYLES --- */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.6);
    z-index: 1001;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}
.modal-overlay.open {
    opacity: 1;
    pointer-events: auto;
}
.modal-box {
    background-color: var(--card);
    padding: 30px;
    border-radius: 14px;
    box-shadow: var(--shadow);
    width: 90%;
    max-width: 400px;
    position: relative;
    transform: scale(0.95);
    transition: transform 0.3s ease;
}
.modal-overlay.open .modal-box {
    transform: scale(1);
}
.modal-close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--muted);
    transition: color 0.3s;
}
.modal-close-btn:hover { color: var(--text); }
.modal-title {
    font-size: 22px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 20px;
}
.form-group { margin-bottom: 15px; }
.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    color: var(--muted);
    margin-bottom: 8px;
}
.form-group input {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--bg);
    color: var(--text);
    font-size: 15px;
    outline: none;
    transition: all 0.3s;
}
.form-group input:focus {
    border-color: var(--accent-1);
    box-shadow: 0 0 0 3px rgba(59,130,246,0.2);
}
.modal-actions { margin-top: 25px; }
.btn-full {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.3s;
    background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
    color: white;
}
.btn-full:hover { opacity: 0.85; }
/* --- END MODAL STYLES --- */

/* Responsive */
@media (max-width:880px){
    .units{ flex-direction:column }
    .nav{ padding:10px; gap:8px }
}

/* tiny helpers */
.muted{ color:var(--muted); font-size:13px }
.spacer{ height:10px }
</style>
</head>
<body data-logged-in="false">

<header>
    <div class="brand" id="logo-home-link">Study Hub — Unitwise Notes</div>

    <div class="header-right">
        <div style="color:white; font-weight:600; margin-right:6px" class="muted" aria-hidden>Theme</div>
        <button id="themeBtn" class="theme-toggle" title="Toggle theme">
            <svg id="icon-sun" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="display:inline-block"><path d="M8 4.5a.5.5 0 0 1 .5-.5h.5V3a.5.5 0 0 1 1 0v1h.5a.5.5 0 0 1 0 1H10v.5a.5.5 0 0 1-1 0V6h-.5a.5.5 0 0 1-.5-.5z"/><path d="M8 1.5a.5.5 0 0 1 .5.5v1.1a.5.5 0 0 1-1 0V2a.5.5 0 0 1 .5-.5zM3.5 8a.5.5 0 0 1 .5-.5h1.1a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.5-.5zM12 8a.5.5 0 0 1 .5-.5h1.1a.5.5 0 0 1 0 1H12.5A.5.5 0 0 1 12 8zM4.97 4.97a.5.5 0 0 1 .707 0l.78.78a.5.5 0 0 1-.707.707l-.78-.78a.5.5 0 0 1 0-.707zM10.343 10.343a.5.5 0 0 1 .707 0l.78.78a.5.5 0 0 1-.707.707l-.78-.78a.5.5 0 0 1 0-.707z"/></svg>
            <svg id="icon-moon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="display:none"><path d="M6 0a6 6 0 1 0 7.464 8.15A7 7 0 1 1 6 0z"/></svg>
            <span id="themeLabel" style="font-size:13px">Light</span>
        </button>
        
        <div class="auth-container">
            <div class="guest-actions">
                <button class="btn" id="open-login-modal-btn">Login</button>
                <button class="btn btn-primary" id="open-signup-modal-btn">Sign Up</button>
            </div>
            <div class="profile-menu-container">
                <button class="profile-btn" id="profile-btn" title="My Profile">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/></svg>
                </button>
                <div class="profile-dropdown" id="profile-dropdown">
                    <button class="profile-dropdown-btn" id="nav-profile-page">My Profile</button>
                    <button class="profile-dropdown-btn" id="nav-settings-page">Settings</button>
                    <div class="dropdown-divider"></div>
                    <button class="profile-dropdown-btn logout-btn" id="logout-btn">Logout</button>
                </div>
            </div>
        </div>
    </div>
</header>

<div id="main-content-wrapper">
    <nav class="nav wrap" aria-label="Main navigation">
        <button onclick="openSection('notes', this)">Notes</button>
        <button onclick="openSection('dpp', this)">DPP</button>
        <button onclick="openSection('pyq', this)">PYQ + Solutions</button>
        <button onclick="openSection('books', this)">Books</button>
        <button onclick="openSection('assign', this)">Assignments</button>
        <button onclick="openSection('mock', this)">Mock Test</button>
        <button onclick="openSection('imp', this)">Important Topics</button>
    </nav>

    <div class="wrap">

        <section id="notes" class="panel" aria-hidden="true" style="display:none">
            <h2>Unitwise Notes</h2>
            <p class="muted">Click a unit to expand — inside each unit you'll find Typed and Handwritten notes.</p>
            <div class="spacer"></div>

            <div class="units">
                <div class="unit-card" onclick="toggleUnit('u1')">
                    <div class="unit-title">
                        <div>Unit 1 — Introduction</div>
                        <div class="badge">4 pages</div>
                    </div>
                    <div class="unit-meta muted">Core topics: Basics, Definitions, Examples</div>

                    <div id="u1" class="collapsible">
                        <div class="inside-list">
                            <div class="inside-item">
                                <div>Typed Notes</div>
                                <div>
                                    <button class="action" onclick="toggleSub(event,'u1-typed')">Open</button>
                                </div>
                            </div>

                            <div id="u1-typed" class="collapsible">
                                <div style="padding:10px 12px; background:transparent; border-left:3px solid var(--accent-1); border-radius:6px; margin:8px 0;">
                                    <strong>Typed Note — Unit 1</strong>
                                    <p class="muted" style="margin:6px 0 0">Short summary and key formulas go here.</p>
                                </div>
                            </div>

                            <div class="inside-item">
                                <div>Handwritten Notes (scan)</div>
                                <div>
                                    <button class="action" onclick="toggleSub(event,'u1-hand')">Open</button>
                                </div>
                            </div>

                            <div id="u1-hand" class="collapsible">
                                <div style="padding:10px 12px; margin-top:8px; border-left:3px solid var(--accent-2); border-radius:6px;">
                                    <strong>Handwritten — Unit 1</strong>
                                    <p class="muted" style="margin:6px 0 0">Link or thumbnail to scanned pages.</p>
                                </div>
                            </div>
                            <div class="inside-item">
                                <div>PYQ / Soln</div>
                                <div><button class="action" onclick="alert('Open PYQ for Unit 1')">Open</button></div>
                            </div>
                            <div class="inside-item">
                                <div>Mock Test (Unit)</div>
                                <div><button class="action" onclick="alert('Start mock test for Unit 1')">Start</button></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="unit-card" onclick="toggleUnit('u2')">
                    <div class="unit-title">
                        <div>Unit 2 — Advanced Topics</div>
                        <div class="badge">6 pages</div>
                    </div>
                    <div class="unit-meta muted">Core topics: Algorithms, Proofs</div>
                    <div id="u2" class="collapsible">
                        <div class="inside-list">
                            <div class="inside-item">
                                <div>Typed Notes</div>
                                <div><button class="action" onclick="toggleSub(event,'u2-typed')">Open</button></div>
                            </div>
                            <div id="u2-typed" class="collapsible">
                                <div style="padding:10px;border-left:3px solid var(--accent-1);border-radius:6px;margin-top:8px">
                                    <strong>Typed Note — Unit 2</strong>
                                    <p class="muted" style="margin:6px 0 0">Add your content here.</p>
                                </div>
                            </div>
                            <div class="inside-item">
                                <div>Handwritten Notes</div>
                                <div><button class="action" onclick="toggleSub(event,'u2-hand')">Open</button></div>
                            </div>
                            <div id="u2-hand" class="collapsible">
                                <div style="padding:10px;border-left:3px solid var(--accent-2);border-radius:6px;margin-top:8px">
                                    <strong>Handwritten — Unit 2</strong>
                                    <p class="muted">Scanned pages / images.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="unit-card" onclick="toggleUnit('u3')">
                    <div class="unit-title">
                        <div>Unit 3 — Practice</div>
                        <div class="badge">3 pages</div>
                    </div>
                    <div class="unit-meta muted">Problems + Exercises</div>
                    <div id="u3" class="collapsible">
                        <div class="inside-list">
                            <div class="inside-item">
                                <div>Typed Notes</div>
                                <div><button class="action" onclick="toggleSub(event,'u3-typed')">Open</button></div>
                            </div>
                            <div id="u3-typed" class="collapsible">
                                <div style="padding:10px;border-left:3px solid var(--accent-1);border-radius:6px;margin-top:8px">
                                    <strong>Typed Notes — Unit 3</strong>
                                    <p class="muted">Short summary.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> </section>

        <section id="dpp" class="panel" aria-hidden="true" style="display:none">
            <h2>Daily Practice Problems (DPP)</h2>
            <p class="muted">Practice sets for daily revision. Click any to open.</p>
            <div style="margin-top:12px">
                <div style="display:flex;gap:10px;flex-wrap:wrap">
                    <button class="action" onclick="alert('DPP Set 1')">DPP Set 1</button>
                    <button class="action" onclick="alert('DPP Set 2')">DPP Set 2</button>
                    <button class="action" onclick="alert('DPP Set 3')">DPP Set 3</button>
                </div>
            </div>
        </section>

        <section id="pyq" class="panel" aria-hidden="true" style="display:none">
            <h2>Previous Year Questions + Solutions</h2>
            <p class="muted">Download sorted PYQs per unit or year.</p>
            <div style="margin-top:12px">
                <div class="inside-item"><div>AKTU 2024 PYQ</div><div><button class="action" onclick="alert('Download PYQ')">Download</button></div></div>
            </div>
        </section>

        <section id="books" class="panel" aria-hidden="true" style="display:none">
            <h2>Books & References</h2>
            <p class="muted">Recommended books and chapters for each unit.</p>
            <div style="margin-top:12px">
                <div class="inside-item"><div>Standard Book A — Chapter 2</div><div><button class="action" onclick="alert('Open book')">Open</button></div></div>
            </div>
        </section>

        <section id="assign" class="panel" aria-hidden="true" style="display:none">
            <h2>Assignments</h2>
            <p class="muted">Weekly / Unit assignments for submission.</p>
            <div style="margin-top:12px"><button class="action" onclick="alert('Assignment 1')">Assignment 1</button></div>
        </section>

        <section id="mock" class="panel" aria-hidden="true" style="display:none">
            <h2>Mock Tests</h2>
            <p class="muted">Full-length mocks and unit-wise mocks.</p>
            <div style="margin-top:12px"><button class="action" onclick="alert('Start Full Mock')">Start Full Mock</button></div>
        </section>

        <section id="imp" class="panel" aria-hidden="true" style="display:none">
            <h2>Important Topics</h2>
            <p class="muted">High-yield topics and exam pointers.</p>
            <ul style="margin-top:10px">
                <li class="muted">Topic 1 — Concept A</li>
                <li class="muted">Topic 2 — Concept B</li>
            </ul>
        </section>

    </div> </div> <div id="profile-page-content" class="wrap panel placeholder-page hidden">
    <h1>My Profile</h1>
    <p>This is where the user's profile information, saved notes, and stats would appear.</p>
</div>
<div id="settings-page-content" class="wrap panel placeholder-page hidden">
    <h1>Settings</h1>
    <p>This is where the user could change their password, email preferences, and other account settings.</p>
</div>

<div class="modal-overlay" id="login-modal">
    <div class="modal-box">
        <button class="modal-close-btn" data-close-modal>&times;</button>
        <h3 class="modal-title">Login to StudyHub</h3>
        <form id="login-form">
            <div class="form-group">
                <label for="login-email">Email</label>
                <input type="email" id="login-email" placeholder="you@example.com" required>
            </div>
            <div class="form-group">
                <label for="login-password">Password</label>
                <input type="password" id="login-password" placeholder="••••••••" required>
            </div>
            <div class="modal-actions">
                <button type="submit" class="btn-full">Login</button>
            </div>
        </form>
    </div>
</div>

<div class="modal-overlay" id="signup-modal">
    <div class="modal-box">
        <button class="modal-close-btn" data-close-modal>&times;</button>
        <h3 class="modal-title">Create your Account</h3>
        <form id="signup-form">
            <div class="form-group">
                <label for="signup-name">Full Name</label>
                <input type="text" id="signup-name" placeholder="Your Name" required>
            </div>
            <div class="form-group">
                <label for="signup-email">Email</label>
                <input type="email" id="signup-email" placeholder="you@example.com" required>
            </div>
            <div class="form-group">
                <label for="signup-password">Password</label>
                <input type="password" id="signup-password" placeholder="Create a password" required>
            </div>
            <div class="modal-actions">
                <button type="submit" class="btn-full">Sign Up</button>
            </div>
        </form>
    </div>
</div>

<script>
// --- 1. THEME HANDLING ---
const themeBtn = document.getElementById('themeBtn');
const themeLabel = document.getElementById('themeLabel');
const iconSun = document.getElementById('icon-sun');
const iconMoon = document.getElementById('icon-moon');

function applyTheme(theme){
    if(theme === 'dark'){
        document.body.classList.add('dark');
        themeLabel.textContent = 'Dark';
        iconSun.style.display = 'none'; iconMoon.style.display = 'inline-block';
    } else {
        document.body.classList.remove('dark');
        themeLabel.textContent = 'Light';
        iconSun.style.display = 'inline-block'; iconMoon.style.display = 'none';
    }
    localStorage.setItem('studyhub_theme', theme);
}

themeBtn.addEventListener('click', ()=>{
    const current = document.body.classList.contains('dark') ? 'dark' : 'light';
    applyTheme(current === 'dark' ? 'light' : 'dark');
});

// init theme from storage or prefer system
(function initTheme(){
    const saved = localStorage.getItem('studyhub_theme');
    if(saved) applyTheme(saved);
    else if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) applyTheme('dark');
    else applyTheme('light');
})();

// --- 2. AUTH, MODAL & PAGE NAVIGATION ---
const bodyElement = document.body;
const profileBtn = document.getElementById('profile-btn');
const profileDropdown = document.getElementById('profile-dropdown');
const logoutBtn = document.getElementById('logout-btn');

// Modal elements
const loginModal = document.getElementById('login-modal');
const signupModal = document.getElementById('signup-modal');
const openLoginBtn = document.getElementById('open-login-modal-btn');
const openSignupBtn = document.getElementById('open-signup-modal-btn');
const loginForm = document.getElementById('login-form');
const signupForm = document.getElementById('signup-form');
const closeButtons = document.querySelectorAll('[data-close-modal]');

// Page content elements
const mainContent = document.getElementById('main-content-wrapper');
const profilePage = document.getElementById('profile-page-content');
const settingsPage = document.getElementById('settings-page-content');
const allPages = [mainContent, profilePage, settingsPage];

// Page navigation buttons
const homeLink = document.getElementById('logo-home-link');
const navProfile = document.getElementById('nav-profile-page');
const navSettings = document.getElementById('nav-settings-page');

// Function to show a specific page and hide others
function showPage(pageToShow) {
    allPages.forEach(page => {
        if (page === pageToShow) {
            page.classList.remove('hidden');
        } else {
            page.classList.add('hidden');
        }
    });
    window.scrollTo(0, 0); // Scroll to top on page change
    profileDropdown.classList.remove('open'); // Close dropdown
}

// Navigation event listeners
homeLink.addEventListener('click', () => showPage(mainContent));
navProfile.addEventListener('click', () => showPage(profilePage));
navSettings.addEventListener('click', () => showPage(settingsPage));

// Function to open a modal
function openModal(modal) {
    modal.classList.add('open');
}

// Function to close a modal
function closeModal(modal) {
    modal.classList.remove('open');
}

// Modal event listeners
openLoginBtn.addEventListener('click', () => openModal(loginModal));
openSignupBtn.addEventListener('click', () => openModal(signupModal));

closeButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        closeModal(loginModal);
        closeModal(signupModal);
    });
});

// Close modal on overlay click
loginModal.addEventListener('click', (e) => {
    if (e.target === loginModal) closeModal(loginModal);
});
signupModal.addEventListener('click', (e) => {
    if (e.target === signupModal) closeModal(signupModal);
});

// Handle Profile Dropdown
profileBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    profileDropdown.classList.toggle('open');
});

document.addEventListener('click', (e) => {
    if (!profileBtn.contains(e.target) && !profileDropdown.contains(e.target)) {
        profileDropdown.classList.remove('open');
    }
});

// Handle (Demo) Login
loginForm.addEventListener('submit', (e) => {
    e.preventDefault(); // Prevent form from submitting
    bodyElement.setAttribute('data-logged-in', 'true');
    closeModal(loginModal);
    showPage(mainContent); // Go to home after login
});

// Handle (Demo) Signup
signupForm.addEventListener('submit', (e) => {
    e.preventDefault();
    // In a real app, you'd create the user, then log them in
    bodyElement.setAttribute('data-logged-in', 'true');
    closeModal(signupModal);
    showPage(mainContent);
});

// Handle (Demo) Logout
logoutBtn.addEventListener('click', (e) => {
    e.preventDefault();
    bodyElement.setAttribute('data-logged-in', 'false');
    profileDropdown.classList.remove('open');
    showPage(mainContent); // Go to home after logout
});

// --- 3. SECTION NAVIGATION (Notes, DPP, etc.) ---
function openSection(id, btn){
    // First, ensure we are on the main content page
    showPage(mainContent);

    // hide all panels
    document.querySelectorAll('.panel').forEach(p=>{
        p.style.display = 'none';
        p.setAttribute('aria-hidden','true');
    });

    // unset active nav buttons
    document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
    // mark clicked nav active
    if(btn) btn.classList.add('active');

    // show selected
    const el = document.getElementById(id);
    if(el){ el.style.display = 'block'; el.setAttribute('aria-hidden','false'); }

    // collapse any open unit/subcontent when changing sections
    document.querySelectorAll('.collapsible.open').forEach(c=>c.classList.remove('open'));
}

// --- 4. COLLAPSIBLE UNIT & SUB-ITEM LOGIC ---
function toggleUnit(id){
    // close other units in notes
    document.querySelectorAll('#notes .collapsible').forEach(c=>{
        if(c.id !== id) c.classList.remove('open');
    });
    const el = document.getElementById(id);
    if(!el) return;
    el.classList.toggle('open');
}

// sub toggles (stop event propagation so parent unit click won't fire)
function toggleSub(e,id){
    e.stopPropagation();
    // close other subitems in same unit
    const unit = e.currentTarget.closest('.unit-card');
    if(unit){
        unit.querySelectorAll('.collapsible').forEach(c=>{ if(c.id !== id) c.classList.remove('open')});
    }
    const el = document.getElementById(id);
    if(el) el.classList.toggle('open');
}

// attach handlers on unit-cards to stop when clicking action buttons
document.querySelectorAll('.unit-card .action').forEach(btn=>{
    btn.addEventListener('click', function(e){ e.stopPropagation(); });
});

// --- 5. KEYBOARD & FOCUS HELPERS ---
document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape') {
        // Close modals
        closeModal(loginModal);
        closeModal(signupModal);
        // Close profile dropdown
        profileDropdown.classList.remove('open');
        // Close collapsible units
        document.querySelectorAll('.collapsible.open').forEach(c=>c.classList.remove('open'));
    }
});

// Prevent nav focus outline weirdness but keep accessibility
document.querySelectorAll('button').forEach(b=>{
    b.addEventListener('mouseup', ()=>b.blur());
});

// --- 6. INITIALIZE PAGE ---
// Open 'notes' section by default on page load
openSection('notes', document.querySelector('.nav button[onclick*="notes"]'));

</script>

</body>
</html>

